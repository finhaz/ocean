<Page x:Class="ocean.Views.CANConfigPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      Title="CANConfigPage"
      d:DesignHeight="600"
      d:DesignWidth="800"
      Style="{DynamicResource PageStyle}"
      mc:Ignorable="d"
      Unloaded="CANConfigPage_Unloaded">

    <Page.Resources>
        <Style x:Key="RoundedButtonStyle" TargetType="Button">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Border" CornerRadius="4" Background="{TemplateBinding Background}" BorderThickness="0">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Opacity" Value="0.9"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Border" Property="Opacity" Value="0.8"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Geometry x:Key="DownloadGeometry">M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z</Geometry>
        <Geometry x:Key="SaveGeometry">M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3M19,19H5V5H16.17L19,7.83V19M12,12V17H7V15H10V13H7V11H12Z</Geometry>
        <Geometry x:Key="RefreshGeometry">M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12C4,15.31 6.69,18 10,18H13.8C13.47,17.2 13.31,16.36 13.31,15.5C13.31,13.5 14.2,11.79 15.65,10.35C17.1,8.9 19,8 21,8A3,3 0 0,1 24,11A3,3 0 0,1 21,14H19A1,1 0 0,0 20,15A1,1 0 0,0 21,16A5,5 0 0,0 26,11A5,5 0 0,0 21,6C19.58,6 18.22,6.5 17.1,7.39L12.71,11.78C12.37,12.12 12.37,12.65 12.71,13.01L15.83,16.13C16.17,16.47 16.69,16.47 17.03,16.13C17.37,15.79 17.37,15.26 17.03,14.92L13.19,11H10C7.79,11 6,9.21 6,7C6,4.79 7.79,3 10,3A4,4 0 0,1 14,7H16.17L17.65,6.35Z</Geometry>
        <Geometry x:Key="SettingsGeometry">M19.14,12.94C19.17,12.65 19.18,12.33 19.18,12C19.18,11.67 19.17,11.34 19.14,11.05L21.15,9.42C21.34,9.24 21.39,8.95 21.26,8.73L19.38,5.55C19.24,5.33 18.95,5.26 18.73,5.4C18.5,5.53 18.43,5.82 18.57,6L19.93,8.36C19.71,8.57 19.5,8.82 19.32,9.1L17.25,10.63C16.79,10.17 16.22,9.82 15.56,9.63L15.34,7.58C15.24,7.27 14.99,7.06 14.68,7.03H14.65C14.33,7.03 14.03,7.24 13.97,7.56L13.17,13.03C13.15,13.28 13.22,13.53 13.36,13.73L11.18,15.31C10.96,15.46 10.76,15.44 10.57,15.26L9.1,13.5C8.88,13.28 8.59,13.22 8.37,13.34L6.2,14.53C6,14.62 5.76,14.5 5.63,14.28C5.5,14.05 5.57,13.77 5.74,13.59L7.62,10.41C7.76,10.19 8.05,10.14 8.27,10.28C8.5,10.41 8.57,10.7 8.43,10.92L7.07,13.18C7.29,13.39 7.5,13.64 7.68,13.92L9.76,12.39C10.22,12.85 10.79,13.2 11.45,13.39L11.67,15.44C11.77,15.75 12.02,15.96 12.33,15.99H12.36C12.68,15.99 12.98,15.78 13.03,15.46L13.83,9.97C13.85,9.72 13.78,9.47 13.64,9.27L15.82,7.69C16.04,7.54 16.24,7.56 16.43,7.74L17.9,9.31C18.12,9.53 18.41,9.6 18.63,9.47L19.96,7.1C20.1,7.29 20.08,7.5 19.94,7.69L18.5,9.97C18.72,9.76 18.97,9.55 19.27,9.37L21.34,7.83C21.55,7.69 21.77,7.9 21.77,8.14V8.17C21.77,8.46 21.61,8.74 21.35,8.9L19.14,12.94M12,15.6C10.02,15.6 8.4,13.98 8.4,12C8.4,10.02 10.02,8.4 12,8.4C13.98,8.4 15.6,10.02 15.6,12C15.6,13.98 13.98,15.6 12,15.6Z</Geometry>
    </Page.Resources>

    <Grid Margin="20" Background="Transparent">
        <!-- 顶部标题+新增【串口配置】按钮 -->
        <StackPanel Orientation="Horizontal" Margin="0,0,0,20" VerticalAlignment="Top">
            <Path Width="32" Height="32" Fill="#2196F3" Data="{StaticResource SettingsGeometry}" Margin="0,0,10,0"/>
            <TextBlock Text="USB-CAN模块参数配置" FontSize="24" FontWeight="Bold" Foreground="#333"/>
            <Button x:Name="BtnSerialConfig" Width="100" Height="32" Margin="20,5,0,0" Content="串口配置" Background="#2196F3" Foreground="White" Style="{StaticResource RoundedButtonStyle}" Click="BtnSerialConfig_Click"/>
        </StackPanel>

        <Grid HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Margin="0,40,0,60">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="20"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.Column="0" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="8" Padding="15" Background="White">
                <StackPanel>
                    <TextBlock Text="基础配置" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,15" Foreground="#2196F3"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12" VerticalAlignment="Center">
                        <TextBlock Text="工作模式：" Width="100" FontSize="14" Foreground="#666"/>
                        <ComboBox Width="200" Height="30" SelectedIndex="{Binding SelectedWorkMode}">
                            <ComboBoxItem>正常工作模式</ComboBoxItem>
                            <ComboBoxItem>环回模式（自收自发测试）</ComboBoxItem>
                        </ComboBox>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12" VerticalAlignment="Center">
                        <TextBlock Text="CAN波特率：" Width="100" FontSize="14" Foreground="#666"/>
                        <ComboBox Width="200" Height="30" SelectedIndex="{Binding SelectedCanBaud}" ItemsSource="{Binding CanBaudList}" DisplayMemberPath="Text"/>
                    </StackPanel>
                    <TextBlock Text="串口参数" FontSize="16" FontWeight="Medium" Margin="0,15,0,8" Foreground="#444"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10" VerticalAlignment="Center">
                        <TextBlock Text="串口波特率：" Width="100" FontSize="14" Foreground="#666"/>
                        <ComboBox Width="200" Height="30" SelectedIndex="{Binding SelectedSerialBaud}" ItemsSource="{Binding PortConfig.BaudRates}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10" VerticalAlignment="Center">
                        <TextBlock Text="数据位：" Width="100" FontSize="14" Foreground="#666"/>
                        <ComboBox Width="200" Height="30" SelectedIndex="{Binding SelectedDataBit}">
                            <ComboBoxItem>8位</ComboBoxItem>
                            <ComboBoxItem>9位</ComboBoxItem>
                        </ComboBox>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10" VerticalAlignment="Center">
                        <TextBlock Text="停止位：" Width="100" FontSize="14" Foreground="#666"/>
                        <ComboBox Width="200" Height="30" SelectedIndex="{Binding SelectedStopBit}">
                            <ComboBoxItem>1位</ComboBoxItem>
                            <ComboBoxItem>1.5位</ComboBoxItem>
                            <ComboBoxItem>2位</ComboBoxItem>
                        </ComboBox>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10" VerticalAlignment="Center">
                        <TextBlock Text="校验位：" Width="100" FontSize="14" Foreground="#666"/>
                        <ComboBox Width="200" Height="30" SelectedIndex="{Binding SelectedParity}">
                            <ComboBoxItem>无校验</ComboBoxItem>
                            <ComboBoxItem>奇校验</ComboBoxItem>
                            <ComboBoxItem>偶校验</ComboBoxItem>
                        </ComboBox>
                    </StackPanel>
                </StackPanel>
            </Border>
            <Border Grid.Column="2" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="8" Padding="15" Background="White">
                <StackPanel>
                    <TextBlock Text="高级配置" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,15" Foreground="#2196F3"/>
                    <TextBlock Text="数据透传格式" FontSize="16" FontWeight="Medium" Margin="0,0,0,8" Foreground="#444"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10" VerticalAlignment="Center">
                        <TextBlock Text="透传使能：" Width="100" FontSize="14" Foreground="#666"/>
                        <ToggleButton Width="60" Height="30" IsChecked="{Binding IsTransEnable}">启用</ToggleButton>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10" VerticalAlignment="Center">
                        <TextBlock Text="帧格式：" Width="100" FontSize="14" Foreground="#666"/>
                        <ComboBox Width="200" Height="30" SelectedIndex="{Binding SelectedFrameFormat}">
                            <ComboBoxItem>标准数据帧（ID最大0x7FF）</ComboBoxItem>
                            <ComboBoxItem>扩展数据帧（ID最大0x1FFFFfff）</ComboBoxItem>
                        </ComboBox>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10" VerticalAlignment="Center">
                        <TextBlock Text="标准帧ID：" Width="100" FontSize="14" Foreground="#666"/>
                        <TextBox Width="200" Height="30" Text="{Binding StdId}" Padding="5" TextAlignment="Right"/>
                        <TextBlock Text=" (0-2047)" Margin="5,0,0,0" FontSize="12" Foreground="#999"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10" VerticalAlignment="Center">
                        <TextBlock Text="扩展帧ID：" Width="100" FontSize="14" Foreground="#666"/>
                        <TextBox Width="200" Height="30" Text="{Binding ExtId}" Padding="5" TextAlignment="Right"/>
                        <TextBlock Text=" (0-536870911)" Margin="5,0,0,0" FontSize="12" Foreground="#999"/>
                    </StackPanel>
                    <TextBlock Text="滤波器配置（第一组）" FontSize="16" FontWeight="Medium" Margin="0,15,0,8" Foreground="#444"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10" VerticalAlignment="Center">
                        <TextBlock Text="滤波器使能：" Width="100" FontSize="14" Foreground="#666"/>
                        <ToggleButton Width="60" Height="30" IsChecked="{Binding IsFilterEnable}">禁用</ToggleButton>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10" VerticalAlignment="Center">
                        <TextBlock Text="过滤ID：" Width="100" FontSize="14" Foreground="#666"/>
                        <TextBox Width="200" Height="30" Text="{Binding FilterId}" Padding="5" TextAlignment="Right"/>
                        <TextBlock Text=" (0-0x1FFFFfff)" Margin="5,0,0,0" FontSize="12" Foreground="#999"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10" VerticalAlignment="Center">
                        <TextBlock Text="掩码ID：" Width="100" FontSize="14" Foreground="#666"/>
                        <TextBox Width="200" Height="30" Text="{Binding MaskId}" Padding="5" TextAlignment="Right"/>
                        <TextBlock Text=" (0-0x1FFFFfff)" Margin="5,0,0,0" FontSize="12" Foreground="#999"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,20,0,0">
            <Button x:Name="BtnRead" Width="100" Height="38" Margin="0,0,10,0" Background="#E0F2F1" Foreground="#00796B" Style="{StaticResource RoundedButtonStyle}" Click="BtnRead_Click">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Path Width="16" Height="16" Fill="#00796B" Data="{StaticResource DownloadGeometry}" Margin="0,0,5,0"/>
                    <TextBlock Text="读取配置"/>
                </StackPanel>
            </Button>
            <Button x:Name="BtnSave" Width="100" Height="38" Margin="0,0,10,0" Background="#2196F3" Foreground="White" Style="{StaticResource RoundedButtonStyle}" Click="BtnSave_Click">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Path Width="16" Height="16" Fill="White" Data="{StaticResource SaveGeometry}" Margin="0,0,5,0"/>
                    <TextBlock Text="保存配置"/>
                </StackPanel>
            </Button>
            <Button x:Name="BtnRestore" Width="100" Height="38" Background="#FFC107" Foreground="#FF8F00" Style="{StaticResource RoundedButtonStyle}" Click="BtnRestore_Click">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Path Width="16" Height="16" Fill="#FF8F00" Data="{StaticResource RefreshGeometry}" Margin="0,0,5,0"/>
                    <TextBlock Text="恢复默认"/>
                </StackPanel>
            </Button>
        </StackPanel>
        <TextBlock HorizontalAlignment="Left" VerticalAlignment="Bottom" Margin="0,0,0,20" FontSize="14" Foreground="#666" Text="{Binding AtModuleStatus}"/>
    </Grid>
</Page>