<Page x:Class="ocean.UI.SerialAllocation"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:ocean.UI"
      mc:Ignorable="d" 
      d:DesignHeight="450" d:DesignWidth="800"
      Title="SerialAllocation" Unloaded="Page_Unloaded" Loaded="Page_Loaded"
      >
    
    <Grid>
        <Grid >
            <Grid.RowDefinitions>
                <RowDefinition Height="110*"/>
                <RowDefinition Height="52*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="122"  MinWidth="122" MaxWidth="200"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="157"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="26*"/>
                        <ColumnDefinition Width="40*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="10*"/>
                        <RowDefinition Height="20*"/>
                        <RowDefinition Height="20*"/>
                        <RowDefinition Height="20*"/>
                        <RowDefinition Height="20*"/>
                        <RowDefinition Height="20*"/>
                        <RowDefinition Height="32*"/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="串   口" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,3,10,3" Grid.Row="1" Height="16" Width="36"/>
                    <TextBlock Text="波特率" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,3,10,3" Grid.Row="2" Height="16" Width="36"/>
                    <TextBlock Text="检验位" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,3,10,3" Grid.Row="3" Height="16" Width="36"/>
                    <TextBlock Text="数据位" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,3,10,3" Grid.Row="4" Height="16" Width="36"/>
                    <TextBlock Text="停止位" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,3,10,4" Grid.Row="5" Height="16" Width="36"/>

                    <ComboBox Name="cbPortName" 
                    Grid.Column="1" Grid.Row="1" 
                    Margin="2,1,10,1" FontSize="10"
                    ItemsSource="{Binding SerialConfig.PortNames, Mode=OneWay}"
                    SelectedItem="{Binding SerialConfig.SelectedPortName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    IsEnabled="{Binding SerialConfig.IsConfigEnabled, Mode=OneWay}"/>


                    <ComboBox Name="cbBaudRate" 
                    Grid.Column="1" Grid.Row="2" 
                    Margin="2,1,10,1" FontSize="10"
                    ItemsSource="{Binding SerialConfig.BaudRates, Mode=OneWay}"
                    SelectedItem="{Binding SerialConfig.SelectedBaudRate, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    IsEnabled="{Binding SerialConfig.IsConfigEnabled, Mode=OneWay}"/>


                    <ComboBox Name="cbParity" 
                    Grid.Column="1" Grid.Row="3" 
                    Margin="2,1,10,1" FontSize="10"
                    ItemsSource="{Binding SerialConfig.ParityNames, Mode=OneWay}"
                    SelectedItem="{Binding SerialConfig.SelectedParityName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    IsEnabled="{Binding SerialConfig.IsConfigEnabled, Mode=OneWay}"/>

                    <ComboBox Name="cbDataBits" 
                    Grid.Column="1" Grid.Row="4" 
                    Margin="2,1,10,1" FontSize="10"
                    ItemsSource="{Binding SerialConfig.DataBits, Mode=OneWay}"
                    SelectedItem="{Binding SerialConfig.SelectedDataBit, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    IsEnabled="{Binding SerialConfig.IsConfigEnabled, Mode=OneWay}"/>
                    
                    <!-- 停止位ComboBox：ItemsSource绑定到StopBitValues -->
                    <ComboBox Name="cbStopBits" 
                    Grid.Column="1" Grid.Row="5" 
                    Margin="2,1,10,1" FontSize="10"
                    ItemsSource="{Binding SerialConfig.StopBitValues, Mode=OneWay}"
                    SelectedItem="{Binding SerialConfig.SelectedStopBit, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    IsEnabled="{Binding SerialConfig.IsConfigEnabled, Mode=OneWay}"/>

                    <Ellipse Name="comState" Style="{Binding SerialConfig.ComStateStyle, Mode=TwoWay}" Grid.Row="6" HorizontalAlignment="Left"
                             Width="20" Margin="15,8,0,7"/>
                    <Button Name="btOpenCom" Content="{Binding SerialConfig.OpenComButtonContent,Mode=TwoWay}" Grid.Column="0" Margin="50,6,10,6" Grid.Row="6" Grid.ColumnSpan="2"
                            Click="btOpenCom_Click" />
                </Grid>
                <Grid Grid.Row="1">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="25"/>
                        <RowDefinition Height="25"/>
                        <RowDefinition Height="25"/>
                        <RowDefinition Height="25"/>
                        <RowDefinition Height="25"/>
                        <RowDefinition Height="25"/>
                        <RowDefinition Height="25"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Button 
                        Name="btClearView" 
                        Content="清空显示" 
                        Margin="10,0,53,0" 
                        Grid.Row="0" 
                        Click="btClearView_Click"></Button>
                    <Button 
                        Visibility="Visible" 
                        Content="停止显示" 
                        Grid.Row="1" 
                        Margin="10,0,53,0"></Button>
                    <CheckBox 
                        Visibility="Visible" 
                        Name="ckAutoClear" 
                        Content="自动清空" 
                        Margin="10,2,0,0" 
                        Grid.Row="2" 
                        VerticalAlignment="Top"/>
                    <CheckBox 
                        Name="ck16View" 
                        Content="16进制显示" 
                        Margin="10,2,0,2" 
                        Grid.Row="3" 
                        Click="ck16View_Click" 
                        IsChecked="{Binding SerialConfig.IsHexView, Mode=TwoWay}" />
                    <Button 
                        Visibility="Visible" 
                        Content="保存显示" 
                        Grid.Row="4" 
                        Margin="10,0,60,0"
                        Command="{Binding SerialConfig.SaveReceiveDataCommand}"/>
                    <Button 
                        Visibility="Visible" 
                        Content="更改" 
                        Grid.Row="4" 
                        Margin="74,0,10,0"></Button>
                    <Button 
                        Visibility="Visible" 
                        Content="搜索空闲串口" 
                        Grid.Row="5"
                        Margin="10,0,50,0"
                        ></Button>


                </Grid>
            </Grid>
            <GridSplitter Grid.Column="1" HorizontalAlignment="Stretch" Width="5"/>
            <Grid Name="grdSend" 
                  Grid.Row="1" 
                  Grid.ColumnSpan="3">
                <Grid.RowDefinitions>
                    <RowDefinition Height="1*"/>
                    <RowDefinition Height="2*"/>
                    <RowDefinition Height="auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="1*"/>
                    <ColumnDefinition Width="2*"/>
                </Grid.ColumnDefinitions>
                <Grid Grid.Column="0" Grid.RowSpan="2">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="1*"/>
                        <RowDefinition Height="1*"/>
                        <RowDefinition Height="1*"/>
                        <RowDefinition Height="1*"/>
                        <RowDefinition Height="1*"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1*"/>
                        <ColumnDefinition Width="1*"/>
                        <ColumnDefinition Width="1"/>
                    </Grid.ColumnDefinitions>
                    <Rectangle 
                        Grid.Column="2"
                        Fill="#FFACACAC" 
                        Width="1" 
                        HorizontalAlignment="Right" 
                        Grid.RowSpan="5"></Rectangle>
                    <Button Name="btSend" 
                            Content="发送" 
                            Grid.Row="0"
                            Grid.RowSpan="2"
                            Grid.Column="1"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch"
                            Margin="10,5,20,5"
                            Click="btSend_Click"/>
                    <Button Name="btExpend" 
                            Content="扩展"
                            Grid.Row="2"
                            Grid.RowSpan="2"
                            Grid.Column="1" 
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch"
                            Margin="10,5,20,5"
                            Click="btExpend_Click"/>
                    <CheckBox Name="ck16Send" 
                              Content="16进制发送" 
                              IsChecked="{Binding SerialConfig.IsHexSend, Mode=TwoWay}" 
                              Grid.Row="0"
                              Grid.Column="0"
                              VerticalAlignment="Top" 
                              Margin="3,3,0,0"
                              Click="ck16Send_Click"/>
                    <CheckBox Name="ckAsciiView" 
                              Content="显示Ascii码"
                              IsChecked="{Binding SerialConfig.IsAsciiView,Mode=TwoWay}"
                              Grid.Row="1"
                              Grid.Column="0" 
                              VerticalAlignment="Top" 
                              Margin="3,3,0,0"
                              Click="ckAsciiView_Click"/>
                    <CheckBox Name="ckAdvantechCmd" 
                              Content="加回车符发送" 
                              Grid.Row="2"
                              Grid.Column="0" 
                              VerticalAlignment="Top"
                              Margin="3,3,0,0"
                              IsChecked="{Binding SerialConfig.IsAdvantechCmdChecked, Mode=TwoWay}"
                              Click="ckAdvantechCmd_Click"/>
                    <CheckBox Name="ckAutoSend" 
                              Content="自动发送"  
                              Grid.Row="3"
                              Grid.Column="0" 
                              VerticalAlignment="Top" 
                              Click="ckAutoSend_Click"
                              Margin="3,3,0,0"
                              IsChecked="{Binding SerialConfig.IsAutoSend}"/>
                    <TextBlock Name="tbkIntervalTime" 
                               HorizontalAlignment="Left" 
                               Grid.Row="4"
                               Grid.Column="0"  
                               TextWrapping="Wrap" 
                               Text="间隔(s)" 
                               VerticalAlignment="Top" 
                               Grid.RowSpan="2" 
                               Margin="3,0,0,0"
                               Visibility="{Binding SerialConfig.TbkIntervalTimeVisibility, Mode=TwoWay}"/>
                    <TextBox Name="tbIntervalTime" 
                             HorizontalAlignment="Right"
                             VerticalAlignment="Stretch"
                             Grid.Row="4"
                             Grid.Column="0"  
                             Text="{Binding SerialConfig.TbIntervalTimeText,Mode=TwoWay}"
                             Margin="0,1,0,1"
                             Width="60"                              
                             Visibility="{Binding SerialConfig.TbIntervalTimeVisibility, Mode=TwoWay}" 
                             TextChanged="tbIntervalTime_TextChanged"/>
                    
                </Grid>
                
                
                <TextBox x:Name="tb16View"
                         Grid.Row="0"
                         Grid.Column="1"
                         VerticalAlignment="Stretch"
                         HorizontalAlignment="Stretch"
                         Margin="3,0,0,0"
                         IsReadOnly="True"
                         IsEnabled="True"
                         Text="{Binding SerialConfig.Tb16ViewText, Mode=OneWay}"
                         Visibility="{Binding SerialConfig.Tb16ViewVisibility, Mode=OneWay}"/>
                <!-- 发送框：通过Style触发器动态调整RowSpan -->
                <TextBox x:Name="tbSend"
                         Grid.Column="1"
                         TextWrapping="Wrap"
                         AcceptsReturn="True"
                         Text="{Binding SerialConfig.TbSendText, Mode=TwoWay}"
                         TextChanged="tbSend_TextChanged"
                         Margin="3,1,0,1">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <!-- 默认样式：tb16View显示时，tbSend占第2行，RowSpan=1 -->
                                <Setter Property="Grid.Row" Value="1"/>
                                <Setter Property="Grid.RowSpan" Value="1"/>
                                <Setter Property="Margin" Value="3,0,0,0"/>
                                <!-- 触发器：当tb16View隐藏时，tbSend占第0行，RowSpan=2 -->
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SerialConfig.Tb16ViewVisibility}" Value="Collapsed">
                                        <Setter Property="Grid.Row" Value="0"/>
                                        <Setter Property="Grid.RowSpan" Value="2"/>
                                        <Setter Property="Margin" Value="3,0,0,0"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                </TextBox>
               
             <StatusBar Name="statusBar1"  Height="20" Grid.Row="3" Grid.ColumnSpan="3" VerticalAlignment="Bottom" Margin="0">
                <TextBlock Text="状态：" 
                           Foreground="Black"/>
                <TextBlock Name="tbComState" 
                           Text="{Binding SerialConfig.TbComStateText,Mode=TwoWay}"
                           Foreground="Black"
                           MinWidth="150"></TextBlock>
                <Separator Background="#FFC9C6C6"/>
                <TextBlock></TextBlock>
                <TextBlock Text="接收："
                           Foreground="Black"/>
                <TextBlock Name="txtRecive" 
                           Text="{Binding SerialConfig.ReceiveCount, Mode=TwoWay}" 
                           MinWidth="100" 
                           Foreground="Black"/>
                <Separator Background="#FFC9C6C6"/>
                <TextBlock Text="发送：" 
                           Foreground="Black"/>
                <TextBlock Name="txtSend" 
                           Text="{Binding SerialConfig.SendCount,Mode=TwoWay}"
                           Foreground="Black"/>
            </StatusBar>   
                
            </Grid>
            <TextBox VerticalScrollBarVisibility="Auto" 
                     IsReadOnly="True" 
                     Name="tbReceive"
                     Grid.Row="0"
                     Grid.Column="2" 
                     Margin="0,1,0,0" 
                     TextWrapping="Wrap" 
                     Text="{Binding SerialConfig.TbReceiveText, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" />

            <Separator Height="1" Grid.Row="1" Grid.ColumnSpan="3" Margin="0,0,0,20" VerticalAlignment="Bottom"/>
            <Rectangle Fill="#FFACACAC" Grid.Row="1" Grid.ColumnSpan="3" VerticalAlignment="Top"  Height="1"/>
            <Rectangle Fill="#FFACACAC" Grid.Column="1" Width="1" HorizontalAlignment="Left"/>
            <Border Name="bdExpend" BorderBrush="#FFD6D6D6" BorderThickness="1" Margin="1,1,1,1"
                Grid.Column="2" HorizontalAlignment="Right" Width="200">
                <Grid Name="gdExpend">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="10*"/>
                        <ColumnDefinition Width="67*"/>
                        <ColumnDefinition Width="23*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="30"/>
                        <RowDefinition Height="30"/>
                        <RowDefinition Height="30"/>
                        <RowDefinition Height="30"/>
                        <RowDefinition Height="30"/>
                        <RowDefinition Height="30"/>
                        <RowDefinition Height="30"/>
                        <RowDefinition Height="30"/>
                        <RowDefinition Height="30"/>
                        <RowDefinition Height="30"/>
                        <RowDefinition Height="30"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="Hex" Grid.ColumnSpan="2" VerticalAlignment="Bottom"/>
                    <TextBlock Text="发送字符串" Grid.Column="1" VerticalAlignment="Bottom" HorizontalAlignment="Center"/>
                    <TextBlock Text="发送" Grid.Column="2" VerticalAlignment="Bottom" HorizontalAlignment="Center"/>
                </Grid>
            </Border>
        </Grid>


    </Grid>
</Page>
